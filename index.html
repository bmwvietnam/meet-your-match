<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEET YOUR MATCH ‚Äì CH·ªåN M·∫™U BMW TH·ªÇ HI·ªÜN C√Å T√çNH</title>

    <!-- 
      DYNAMIC OG META TAGS 
      Nh·ªØng th·∫ª n√†y s·∫Ω ƒë∆∞·ª£c JavaScript c·∫≠p nh·∫≠t ƒë·ªông d·ª±a tr√™n k·∫øt qu·∫£ quiz.
    -->
    <meta property="og:title" content="MEET YOUR MATCH ‚Äì CH·ªåN M·∫™U BMW TH·ªÇ HI·ªÜN C√Å T√çNH" />
    <meta property="og:description" content="Kh√°m ph√° ngay m·∫´u BMW n√†o ph√π h·ª£p nh·∫•t v·ªõi b·∫°n!" />
    <!-- B·∫°n C·∫¶N thay th·∫ø b·∫±ng ·∫£nh thumbnail m·∫∑c ƒë·ªãnh c·ªßa s·ª± ki·ªán -->
    <meta property="og:image" content="https://placehold.co/1200x630/0066CC/FFFFFF?text=BMW%20EVENT&font=exo2" /> 
    <meta property="og:url" content="https://meetyourmatch.event-bmw.vn" /> <!-- B·∫°n C·∫¶N thay th·∫ø b·∫±ng domain c·ªßa m√¨nh -->
    <meta name="twitter:card" content="summary_large_image" />
	
	<!-- favicons start -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://d35wmn7bemzfye.cloudfront.net/016cb055e264cba17dedfeab958d53e1983cc9af/1747652511/images/ico/apple-touch-icon-144-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://d35wmn7bemzfye.cloudfront.net/016cb055e264cba17dedfeab958d53e1983cc9af/1747652511/images/ico/apple-touch-icon-114-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://d35wmn7bemzfye.cloudfront.net/016cb055e264cba17dedfeab958d53e1983cc9af/1747652511/images/ico/apple-touch-icon-72-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://d35wmn7bemzfye.cloudfront.net/016cb055e264cba17dedfeab958d53e1983cc9af/1747652511/images/ico/apple-touch-icon-57-precomposed.png">
	<link rel="shortcut icon" type="image/x-icon" href="https://d35wmn7bemzfye.cloudfront.net/016cb055e264cba17dedfeab958d53e1983cc9af/1747652511/images/ico/favicon.ico">        <!-- favicons end -->

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- (THAY TH·∫æ) Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- (X√ìA) Lucide Icons
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    -->
    <!-- Google Fonts: Inter (Body) & Exo 2 (Headings) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700;900&family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- (M·ªöI) C·∫•u h√¨nh Tailwind -->
    <script>
        tailwind.config = {
            darkMode: 'class', // B·∫≠t dark mode
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'], // Font ch·ªØ m·∫∑c ƒë·ªãnh
                        'heading': ['Exo 2', 'sans-serif'] // Font ch·ªØ cho ti√™u ƒë·ªÅ
                    },
                    colors: {
                        'bmw-blue': {
                            'DEFAULT': '#0066CC',
                            'light': '#0099FF',
                            'dark': '#004999'
                        }
                    }
                }
            }
        }
    </script>

    <!-- (M·ªöI) CSS T·ªëi Gi·∫£n -->
    <style>
        /* (M·ªöI) Th√™m logic ·∫©n/hi·ªán section */
        .section {
            display: none;
        }
        .section.active {
            display: block;
            /* Th√™m animation cho m∆∞·ª£t */
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* (M·ªöI) Th√™m hi·ªáu ·ª©ng fade-in cho container ch√≠nh */
        @keyframes containerFadeIn {
            from { opacity: 0; transform: scale(0.98) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .container {
            /* √Åp d·ª•ng hi·ªáu ·ª©ng */
            animation: containerFadeIn 0.6s ease-out;
        }

        /* CSS cho Loading Spinner (Gi·ªØ nguy√™n) */
        .loader {
            width: 1.5rem; /* 24px */
            height: 1.5rem; /* 24px */
            border-width: 4px;
            border-color: white;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(30deg); }
        }

        /* (M·ªöI) Ghi ƒë√® style cho n√∫t trong Modal ƒë·ªÉ ƒë·ªìng b·ªô */
        .btn-modal-primary {
            background-color: #0066CC; /* bg-bmw-blue */
            color: white;
            font-weight: 700;
            padding: 0.75rem 2rem; /* 12px 32px */
            border-radius: 0.5rem; /* 8px */
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.875rem; /* 14px */
            transition: all 0.3s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: scale(1);
            font-family: 'Inter', sans-serif;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn-modal-primary:hover {
            background-color: #0099FF; /* bg-bmw-light */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: scale(1.05);
        }
        .btn-modal-secondary {
            background-color: #4B5563; /* gray-600 */
            color: white;
            font-weight: 700;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.875rem;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }
        .btn-modal-secondary:hover {
            background-color: #6B7280; /* gray-500 */
        }
        
        /* (M·ªöI) Style cho form trong Modal (C·∫≠p nh·∫≠t sang Light theme) */
        #register-form .form-input, #register-form .form-select, #social-share-section .form-input {
            width: 100%;
            padding: 0.75rem 1rem; /* 12px 16px */
            border: 1px solid #D1D5DB; /* border-gray-300 */
            border-radius: 0.5rem; /* 8px */
            font-size: 1rem; /* 16px */
            background-color: #F9FAFB; /* bg-gray-50 */
            color: #111827; /* text-gray-900 */
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }
        #register-form .form-input:focus, #register-form .form-select:focus, #social-share-section .form-input:focus {
            outline: none;
            border-color: #0066CC; /* bmw-blue */
            background-color: #FFFFFF; /* bg-white */
            box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.5); /* ring-2 ring-blue-500/50 */
        }
        #register-form .form-checkbox-label {
            display: flex;
            align-items: center;
            font-size: 0.875rem; /* 14px */
            color: #374151; /* text-gray-700 */
            font-family: 'Inter', sans-serif;
        }
        #register-form .form-checkbox {
            height: 1rem; /* 16px */
            width: 1rem;
            color: #0066CC; /* text-bmw-blue */
            border-color: #D1D5DB; /* border-gray-300 */
            background-color: #F9FAFB; /* bg-gray-50 */
            border-radius: 0.25rem;
        }
        #register-form .form-checkbox:focus {
             box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.5);
             outline: none;
        }

        /* (M·ªöI) CSS cho Video Modal (Tailwind Aspect Ratio) */
        .aspect-w-16 {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio (9 / 16 = 0.5625) */
        }
        .aspect-h-9 {
            /* This class is a companion to aspect-w-16 */
        }
        .aspect-w-16 > * {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans min-h-screen p-4 md:p-8 flex items-center justify-center">
    
    <!-- (M·ªöI) Container ch√≠nh, d√πng Tailwind -->
    <div class="container max-w-3xl w-full mx-auto bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl shadow-2xl overflow-hidden">
        
        <!-- (M·ªöI) Header v·ªõi Logo BMW -->
        <div class="header p-8 text-center border-b border-gray-200">
            <img src="https://d35wmn7bemzfye.cloudfront.net/016cb055e264cba17dedfeab958d53e1983cc9af/1747652511/images/logo.png" 
                 alt="Logo BMW" 
                 class="h-16 md:h-12 w-auto mx-auto mb-6"
                 onerror="this.style.display='none'">
            <h1 class="text-3xl font-bold text-zinc-900 mb-2 font-heading uppercase tracking-wide">
                MEET YOUR MATCH
            </h1>
            <p class="text-lg text-gray-600">Ch·ªçn m·∫´u BMW th·ªÉ hi·ªán c√° t√≠nh</p>
        </div>

        <div class="content p-6 md:p-10">
            <!-- Welcome Section -->
            <div id="welcomeSection" class="section active">
                <div class="text-center">
                    <!-- (THAY ƒê·ªîI) Icon xe h∆°i Font Awesome -->
                    <div class="text-7xl mb-6 text-bmw-blue">
                        <i class="fa-solid fa-car-side"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-bmw-blue mb-4 font-heading">
                        Ch√†o m·ª´ng ƒë·∫øn v·ªõi MEET YOUR MATCH!
                    </h2>
                    <div class="text-lg text-gray-700 mb-8 max-w-2xl mx-auto">
                        BMW l√† bi·ªÉu t∆∞·ª£ng c·ªßa s·ª± ho√†n h·∫£o, k·∫øt h·ª£p gi·ªØa c√¥ng ngh·ªá ti√™n ti·∫øn v√† thi·∫øt k·∫ø ƒë·∫≥ng c·∫•p. 
                        Nh∆∞ng m·ªói c√° nh√¢n c√≥ m·ªôt phong c√°ch s·ªëng ri√™ng, m·ªôt c√° t√≠nh ƒë·ªôc ƒë√°o. 
                        <br><br>
                        <strong class="text-zinc-900">H√£y tr·∫£ l·ªùi 6 c√¢u h·ªèi ƒë·ªÉ kh√°m ph√° d√≤ng BMW n√†o ph√π h·ª£p nh·∫•t v·ªõi b·∫°n!</strong>
                    </div>
                </div>

                <div class="form-group mb-6">
                    <label for="customerName" class="block text-sm font-medium text-gray-600 mb-2">T√™n c·ªßa b·∫°n l√† g√¨? *</label>
                    <input type="text" id="customerName" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." maxlength="50" 
                           class="w-full p-4 bg-white border border-gray-300 rounded-lg text-zinc-900 focus:ring-bmw-blue focus:border-bmw-blue transition placeholder:text-gray-400">
                </div>

                <!-- (M·ªöI) N√∫t b·∫•m d√πng Tailwind -->
                <button class="btn w-full p-4 bg-bmw-blue hover:bg-bmw-light text-white font-bold rounded-lg uppercase tracking-wider text-sm transition-all duration-300 flex items-center justify-center gap-2 group" id="startBtn" onclick="startQuiz()">
                    B·∫Øt ƒë·∫ßu ngay!
                    <!-- (THAY TH·∫æ) Icon Font Awesome -->
                    <i class="fa-solid fa-arrow-right w-5 h-4 transition-transform group-hover:translate-x-1"></i>
                </button>
            </div>

            <!-- Quiz Section -->
            <div id="quizSection" class="section">
                <!-- (M·ªöI) Progress Bar d√πng Tailwind -->
                <div class="progress-bar bg-gray-200 h-2 rounded-full mb-8 overflow-hidden">
                    <div class="progress-fill bg-bmw-blue h-2 rounded-full transition-all duration-500" id="progressBar"></div>
                </div>

                <div id="questionsContainer">
                    <!-- JS s·∫Ω render c√¢u h·ªèi v√†o ƒë√¢y -->
                    <!-- (M·ªöI) C·∫•u tr√∫c c√¢u h·ªèi ƒë√£ ƒë∆∞·ª£c thi·∫øt k·∫ø l·∫°i -->
                    <!--
                    <div class="question-number text-sm font-semibold text-bmw-blue mb-2">C√¢u 1 / 6</div>
                    <div class="question-text text-2xl font-bold text-white mb-8 font-heading">Cu·ªëi tu·∫ßn l√Ω t∆∞·ªüng c·ªßa b·∫°n l√† g√¨?</div>
                    <div class="options flex flex-col gap-4">
                        <div class="option flex items-center p-5 bg-zinc-700 rounded-lg border-2 border-zinc-600 cursor-pointer transition-all duration-200 hover:border-bmw-blue hover:bg-zinc-600/50">
                            <div class="option-label w-8 h-8 rounded-full bg-zinc-600 flex items-center justify-center font-bold text-zinc-300 flex-shrink-0 transition-all duration-200">A</div>
                            <div class="option-text ml-4 flex-1 text-lg text-white">L√™n ƒë∆∞·ªùng kh√°m ph√° nh·ªØng cung ƒë√®o m·ªõi</div>
                            <span class="badge ml-auto bg-zinc-600 text-zinc-300 text-xs font-medium px-3 py-1 rounded-full whitespace-nowrap">Traveler</span>
                        </div>
                        <div class="option selected flex items-center p-5 bg-blue-900/50 rounded-lg border-2 border-bmw-blue cursor-pointer transition-all duration-200">
                            <div class="option-label w-8 h-8 rounded-full bg-bmw-blue flex items-center justify-center font-bold text-white flex-shrink-0 transition-all duration-200">B</div>
                            <div class="option-text ml-4 flex-1 text-lg text-white">C√† ph√™ sang - ƒê√†m nghi·ªám c√¥ng ngh·ªá</div>
                            <span class="badge ml-auto bg-bmw-blue text-white text-xs font-medium px-3 py-1 rounded-full whitespace-nowrap">Visionary</span>
                        </div>
                    </div>
                    -->
                </div>

                <!-- (M·ªöI) N√∫t b·∫•m d√πng Tailwind -->
                <button class="btn w-full p-4 bg-bmw-blue hover:bg-bmw-light text-white font-bold rounded-lg uppercase tracking-wider text-sm transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-bmw-blue" id="nextBtn" onclick="nextQuestion()" disabled>
                    Ti·∫øp theo
                </button>
                <button class="btn btn-secondary w-full p-4 mt-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold rounded-lg uppercase tracking-wider text-sm transition-all duration-300" onclick="previousQuestion()">
                    Quay l·∫°i
                </button>
            </div>

            <!-- Result Section -->
            <div id="resultSection" class="section">
                <!-- (M·ªöI) Th·∫ª k·∫øt qu·∫£ d√πng Tailwind -->
                <div class="result-card bg-white border border-bmw-blue/30 p-6 md:p-8 rounded-xl text-center shadow-lg mb-8">
                    <!-- (THAY ƒê·ªîI) Icon k·∫øt qu·∫£ s·∫Ω do JS render -->
                    <div class="result-icon text-7xl mb-4 text-bmw-blue" id="resultIcon">
                        <!-- JS s·∫Ω ch√®n icon FA v√†o ƒë√¢y -->
                    </div>
                    <div class="result-title text-3xl font-bold text-zinc-900 mb-2 font-heading" id="resultTitle"></div>
                    <div class="result-subtitle text-xl text-bmw-blue mb-4 font-heading" id="resultSubtitle"></div>
                    <div class="result-desc text-lg text-gray-700 max-w-2xl mx-auto" id="resultDesc"></div>
                </div>

                <!-- (M·ªöI) Th·∫ª c√° t√≠nh d√πng Tailwind -->
                <div class="personality-traits grid grid-cols-1 md:grid-cols-3 gap-4 my-8" id="personalityTraits">
                    <!--
                    <div class="trait-card bg-zinc-700 p-6 rounded-lg text-center transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                        <div class="trait-icon text-4xl mb-3 text-bmw-blue">üåç</div>
                        <div class="trait-name text-lg font-semibold text-white mb-1">Kh√°m ph√°</div>
                        <div class="trait-desc text-sm text-gray-400">Lu√¥n s·∫µn s√†ng cho chuy·∫øn ƒëi m·ªõi</div>
                    </div>
                    -->
                </div>

                <!-- (M·ªöI) Chi ti·∫øt xe d√πng Tailwind -->
                <div class="car-details bg-gray-50 rounded-lg border border-gray-200 p-6 mb-8">
                    <h3 class="text-xl font-bold text-zinc-900 mb-6 font-heading">Chi ti·∫øt d√≤ng xe c·ªßa b·∫°n</h3>
                    <div id="carDetails">
                        <!--
                        <div class="detail-row flex justify-between items-center py-4 border-b border-zinc-700 last:border-b-0">
                            <span class="detail-label text-gray-400">D√≤ng xe:</span>
                            <span class="detail-value font-semibold text-white text-lg">BMW X3 / X5 / X7</span>
                        </div>
                        -->
                    </div>
                </div>

                <div class="text-center my-8">
                    <p class="text-xl font-semibold text-zinc-900 mb-4">
                        üéÅ Chia s·∫ª k·∫øt qu·∫£ v√† tham gia s·ª± ki·ªán l√°i th·ª≠!
                    </p>
                    <p class="text-gray-600">
                        #MeetYourMatch #ThacoAuto #BMWVietnam #DriveYourPassion
                    </p>
                </div>

                <!-- (M·ªöI) N√∫t b·∫•m d√πng Tailwind -->
                <button id="open-share-modal-btn" class="btn w-full p-4 bg-bmw-blue hover:bg-bmw-light text-white font-bold rounded-lg uppercase tracking-wider text-sm transition-all duration-300 flex items-center justify-center gap-2" style="margin-top: 20px;">
                    <!-- (THAY TH·∫æ) Icon Font Awesome -->
                    <i class="fa-solid fa-share-nodes w-5 h-5"></i>
                    Chia s·∫ª & ƒêƒÉng k√Ω l√°i th·ª≠
                </button>

                <button class="btn btn-secondary w-full p-4 mt-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold rounded-lg uppercase tracking-wider text-sm transition-all duration-300 flex items-center justify-center gap-2" onclick="restartQuiz()">
                    Ch∆°i l·∫°i
                    <!-- (THAY TH·∫æ) Icon Font Awesome -->
                    <i class="fa-solid fa-rotate-right w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- ===== (M·ªöI) SHARE/REGISTER MODAL (ƒê√É C·∫¨P NH·∫¨T GIAO DI·ªÜN DARK MODE) ===== -->
    <div id="share-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-80 backdrop-blur-sm hidden opacity-0 font-['Inter',_sans-serif]">
        
        <!-- (M·ªöI) N·ªôi dung Modal - (C·∫≠p nh·∫≠t sang Light Mode) -->
        <div id="share-modal-content" class="bg-white border border-gray-200 text-gray-900 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform scale-95">
            <div class="p-6 md:p-10 relative">
                <!-- Close Button -->
                <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-800 transition-colors">
                    <!-- (THAY TH·∫æ) Icon Font Awesome -->
                    <i class="fa-solid fa-xmark w-8 h-8"></i>
                </button>

                <h2 class="text-2xl md:text-3xl font-bold text-center mb-6 text-gray-900" style="font-family: 'Exo 2', sans-serif;">
                    Chia s·∫ª ƒë·ªÉ nh·∫≠n qu√†!
                </h2>
                <p class="text-center text-gray-600 mb-8">
                    B·∫°n c√≥ mu·ªën ƒëƒÉng k√Ω l√°i th·ª≠ t·∫°i s·ª± ki·ªán ƒë·ªÉ c√≥ c∆° h·ªôi nh·∫≠n qu√†?
                </p>

                <!-- Yes/No Buttons -->
                <div id="drive-confirm-buttons" class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
                    <button id="register-yes-btn" class="btn-modal-primary flex-1">
                        <!-- (THAY TH·∫æ) Icon Font Awesome -->
                        <i class="fa-solid fa-check inline-block w-5 h-5 mr-2 -mt-1"></i>
                        C√≥, ƒëƒÉng k√Ω ngay
                    </button>
                    <button id="register-no-btn" class="btn-modal-secondary flex-1">
                        Kh√¥ng, ch·ªâ chia s·∫ª
                    </button>
                </div>

                <!-- Registration Form (Initially hidden) -->
                <!-- (M·ªöI) ƒê√£ √°p d·ª•ng style dark mode t·ª´ <style> -->
                <form id="register-form" class="hidden space-y-4">
                    <h3 class="text-xl font-semibold text-center mb-4 text-gray-900" style="font-family: 'Exo 2', sans-serif;">
                        Ho√†n t·∫•t ƒëƒÉng k√Ω
                    </h3>
                    <div>
                        <label for="full-name" class="block text-sm font-medium text-gray-700 mb-1">H·ªç v√† t√™n *</label>
                        <input type="text" id="full-name" name="full-name" required class="form-input">
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" id="email" name="email" required class="form-input">
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">S·ªë ƒëi·ªán tho·∫°i *</label>
                            <input type="tel" id="phone" name="phone" required class="form-input">
                        </div>
                    </div>
                    <div>
                        <label for="car-model" class="block text-sm font-medium text-gray-700 mb-1">D√≤ng xe mu·ªën l√°i th·ª≠ *</label>
                        <select id="car-model" name="car-model" class="form-select appearance-none">
                            <option value="">ƒêang t·∫£i...</option>
                        </select>
                    </div>
                    <div class="flex items-center">
                        <label for="license-confirm" class="form-checkbox-label">
                            <input type="checkbox" id="license-confirm" name="license-confirm" required class="form-checkbox mr-2 focus:ring-transparent focus:ring-offset-0">
                            T√¥i x√°c nh·∫≠n c√≥ b·∫±ng l√°i xe √¥ t√¥ (B1 tr·ªü l√™n)
                        </label>
                    </div>
                    <div>
                        <label for="prediction-count" class="block text-sm font-medium text-gray-400 mb-1">D·ª± ƒëo√°n s·ªë ng∆∞·ªùi tham gia minigame *</label>
                        <input type="number" id="prediction-count" name="prediction-count" required placeholder="Nh·∫≠p con s·ªë d·ª± ƒëo√°n c·ªßa b·∫°n" class="form-input">
                        <p class="text-xs text-gray-500 mt-1">Ph·∫ßn th∆∞·ªüng d√†nh cho ng∆∞·ªùi d·ª± ƒëo√°n ƒë√∫ng ho·∫∑c g·∫ßn ƒë√∫ng (th·∫•p h∆°n).</p>
                    </div>
                </form>

                <!-- Social Share Section (Initially hidden) -->
                <div id="social-share-section" class="hidden">
                    <hr class="my-8 border-gray-200">
                    <p class="text-center font-semibold text-gray-700 mb-4">
                        B∆∞·ªõc 1: Chia s·∫ª b√†i vi·∫øt l√™n m·∫°ng x√£ h·ªôi
                    </p>
                    <div class="flex justify-center gap-4 mb-6">
                        
                        <!-- (C·∫¨P NH·∫¨T) N√∫t Facebook (Icon Font Awesome Square) -->
                        <button onclick="handleCopyLink()" class="w-14 h-14 bg-[#1877F2] text-white rounded-full flex items-center justify-center transition-opacity hover:opacity-80" aria-label="Sao ch√©p n·ªôi dung Facebook">
                            <i class="fa-brands fa-square-facebook text-4xl"></i>
                        </button>
                        
                        <!-- (ƒê√É X√ìA) N√∫t Zalo -->

                        <!-- (C·∫¨P NH·∫¨T) N√∫t Copy Link (Icon Font Awesome Copy) -->
                        <button onclick="handleCopyLink()" class="w-14 h-14 bg-gray-500 text-white rounded-full flex items-center justify-center transition-opacity hover:opacity-80" aria-label="Sao ch√©p li√™n k·∫øt">
                            <i class="fa-solid fa-copy text-2xl"></i>
                        </button>
                    </div>
                    
                    <!-- (M·ªöI) N√∫t h∆∞·ªõng d·∫´n chia s·∫ª -->
                    <div class="text-center mb-6">
                        <button id="open-guide-btn" class="text-sm text-bmw-blue hover:text-bmw-light font-semibold transition-colors">
                            <i class="fa-regular fa-circle-question mr-1"></i>
                            Xem h∆∞·ªõng d·∫´n chia s·∫ª
                        </button>
                    </div>

                    <p class="text-center font-semibold text-gray-700 mb-4 mt-8">
                        B∆∞·ªõc 2: D√°n link b√†i ƒë√£ chia s·∫ª
                    </p>
                    <div>
                        <label for="share-link" class="sr-only">Link b√†i vi·∫øt ƒë√£ chia s·∫ª</label>
                        <input type="url" id="share-link" name="share-link" required placeholder="https://facebook.com/your-post-link" class="form-input">
                    </div>

                    <button id="complete-btn" class="btn-modal-primary w-full mt-8 text-lg">
                        Ho√†n th√†nh
                        <span id="loading-spinner" class="loader ml-2 hidden"></span>
                    </button>
                    <p id="form-status" class="text-center text-sm mt-4 text-gray-500"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== (M·ªöI) VIDEO GUIDE MODAL ===== -->
    <div id="guide-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-80 backdrop-blur-sm hidden opacity-0 font-['Inter',_sans-serif]">
        <div id="guide-modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl transform scale-95 transition-all duration-300">
            <div class="p-4 relative">
                <!-- Close Button -->
                <button id="close-guide-btn" class="absolute -top-3 -right-3 z-10 text-white bg-gray-800 rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600 transition-colors">
                    <i class="fa-solid fa-xmark w-5 h-5"></i>
                </button>
                
                <!-- Video Container -->
                <div class="aspect-w-16 aspect-h-9 bg-black rounded-lg overflow-hidden">
                    <!-- THAY TH·∫æ LINK YOUTUBE C·ª¶A B·∫†N T·∫†I ƒê√ÇY -->
                    <!-- D√πng 'embed' link, kh√¥ng ph·∫£i link 'watch' -->
                    <iframe id="guide-video-iframe" class="w-full h-full" 
                            src="https://www.youtube.com/embed/dQw4w9WgXcQ" 
                            title="YouTube video player" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                    </iframe>
                    <!-- Ho·∫∑c d√πng video MP4:
                    <video id="guide-video-mp4" class="w-full h-full" controls src="path/to/your/video.mp4">
                        Your browser does not support the video tag.
                    </video>
                    -->
                </div>
            </div>
        </div>
    </div>
    <!-- ===== H·∫æT VIDEO GUIDE MODAL ===== -->


    <script>
        // --- (X√ìA) Kh·ªüi t·∫°o Lucide Icons ---
        // lucide.createIcons();

        // --- D·ªØ li·ªáu c√¢u h·ªèi ---
        const questions = [
            {
                id: 1,
                text: "Cu·ªëi tu·∫ßn l√Ω t∆∞·ªüng c·ªßa b·∫°n l√† g√¨?",
                options: [
                    { text: "L√™n ƒë∆∞·ªùng kh√°m ph√° nh·ªØng cung ƒë√®o m·ªõi", type: "Traveler" },
                    { text: "C√† ph√™ sang - ƒê√†m nghi·ªám c√¥ng ngh·ªá", type: "Visionary" },
                    { text: "Ra ƒë∆∞·ªùng ƒëua, ngh·∫πt th·ªü v·ªõi t·ªëc ƒë·ªô", type: "Performer" },
                    { text: "Ph·ªë ph∆∞·ªùng - Linh ho·∫°t trong ƒë√¥ th·ªã", type: "Icon" }
                ]
            },
            {
                id: 2,
                text: "T√≠nh c√°ch n√†o m√¥ t·∫£ b·∫°n r√µ nh·∫•t?",
                options: [
                    { text: "T·ª± do - Th√≠ch kh√°m ph√°", type: "Traveler" },
                    { text: "S√°ng t·∫°o - C·∫ßu ti·∫øn - Y√™u ƒë·ªïi m·ªõi", type: "Visionary" },
                    { text: "Quy·∫øt ƒëo√°n - Quy·∫øt li·ªát trong m·ªçi vi·ªác", type: "Performer" },
                    { text: "Thanh l·ªãch - Tinh t·∫ø - H∆∞·ªõng ƒë·∫øn sang tr·ªçng", type: "Icon" }
                ]
            },
            {
                id: 3,
                text: "Playlist b·∫°n nghe khi l√°i xe?",
                options: [
                    { text: "Indie/Chill - Th∆∞ th√°i", type: "Traveler" },
                    { text: "Electronic/Pop - Lu√¥n c·∫≠p nh·∫≠t", type: "Visionary" },
                    { text: "Rock/Hip-hop - NƒÉng l∆∞·ª£ng", type: "Performer" },
                    { text: "Pop/Acoustic - Ph√π h·ª£p m·ªçi kho·∫£nh kh·∫Øc", type: "Icon" }
                ]
            },
            {
                id: 4,
                text: "Khi ch·ªçn xe, ƒëi·ªÅu g√¨ quan tr·ªçng nh·∫•t?",
                options: [
                    { text: "Kh√¥ng gian - Ti·ªán nghi du l·ªãch", type: "Traveler" },
                    { text: "C√¥ng ngh·ªá - Th√¥ng minh - T∆∞∆°ng lai", type: "Visionary" },
                    { text: "Hi·ªáu nƒÉng - T·ªëc ƒë·ªô - S·ª©c m·∫°nh", type: "Performer" },
                    { text: "B·ªÅ d∆∞∆°ng - Ph√π h·ª£p m·ªçi t√¨nh hu·ªëng", type: "Icon" }
                ]
            },
            {
                id: 5,
                text: "Phong c√°ch l√°i xe c·ªßa b·∫°n nh∆∞ th·∫ø n√†o?",
                options: [
                    { text: "C·∫©n th·∫≠n, h√†nh tr√¨nh n√†o c≈©ng l√† tr·∫£i nghi·ªám", type: "Traveler" },
                    { text: "T·ªânh t√°o, m·ªçi thao t√°c l√† m·ªôt c·∫£m gi√°c t·ªëi ∆∞u", type: "Visionary" },
                    { text: "T·ª± tin, lu√¥n s·∫µn s√†ng th√∫ng th·∫Øc", type: "Performer" },
                    { text: "Linh ho·∫°t, th√≠ch c·∫£m gi√°c ki·ªÉm so√°t trong ph·ªë", type: "Icon" }
                ]
            },
            {
                id: 6,
                text: "M·ªôt c√¢u m√¥ t·∫£ l√Ω t∆∞·ªüng s·ªëng c·ªßa b·∫°n",
                options: [
                    { text: "ƒêi ƒë·ªÉ tr·∫£i nghi·ªám nhi·ªÅu h∆°n", type: "Traveler" },
                    { text: "Th∆∞∆°ng l√°i l√† ng√†y h√¥m nay", type: "Visionary" },
                    { text: "S·ªëng h·∫øt m√¨nh v·ªõi ƒëam m√™", type: "Performer" },
                    { text: "Phong c√°ch l√† s·∫µn ƒë√£ c√≥ s·∫µn", type: "Icon" }
                ]
            }
        ];

        // --- (THAY ƒê·ªîI) D·ªØ li·ªáu k·∫øt qu·∫£ - C·∫≠p nh·∫≠t Icon Font Awesome ---
        const carTypes = {
            Traveler: {
                icon: '<i class="fa-solid fa-mountain-sun"></i>', // ƒê√£ thay ƒë·ªïi
                name: "THE TRAVELER",
                car: "BMW X Series - X3, X5, X7",
                slogan: "Gia ƒë√¨nh - Tr·∫£i nghi·ªám - Drive every road",
                description: "B·∫°n l√† ng∆∞·ªùi y√™u t·ª± do, kh√°m ph√° v√† tr·∫£i nghi·ªám. BMW X Series v·ªõi kh√¥ng gian r·ªông r√£i, c√¥ng ngh·ªá an to√†n v√† kh·∫£ nƒÉng v·∫≠n h√†nh ƒëa ƒë·ªãa h√¨nh l√† ng∆∞·ªùi b·∫°n ƒë·ªìng h√†nh ho√†n h·∫£o cho m·ªçi h√†nh tr√¨nh.",
                traits: [
                    { icon: '<i class="fa-solid fa-earth-americas"></i>', name: "Kh√°m ph√°", desc: "Lu√¥n s·∫µn s√†ng cho chuy·∫øn ƒëi m·ªõi" }, // ƒê√£ thay ƒë·ªïi
                    { icon: '<i class="fa-solid fa-users-line"></i>', name: "Gia ƒë√¨nh", desc: "∆Øu ti√™n s·ª± tho·∫£i m√°i v√† an to√†n" }, // ƒê√£ thay ƒë·ªïi
                    { icon: '<i class="fa-solid fa-road"></i>', name: "Linh ho·∫°t", desc: "Chinh ph·ª•c m·ªçi ƒë·ªãa h√¨nh" } // ƒê√£ thay ƒë·ªïi
                ],
                features: [
                    { label: "D√≤ng xe", value: "BMW X3 / X5 / X7" },
                    { label: "ƒê·∫∑c ƒëi·ªÉm", value: "SUV ƒëa d·ª•ng, r·ªông r√£i" },
                    { label: "Ph√π h·ª£p", value: "Gia ƒë√¨nh, du l·ªãch xa" },
                    { label: "C√¥ng ngh·ªá", value: "xDrive, Comfort Access" }
                ],
                id: "traveler",
                carsList: ["BMW X3", "BMW X5", "BMW X7"],
                ogImage: "https://placehold.co/1200x630/3498DB/FFFFFF?text=THE%20TRAVELER&font=exo2",
                shareText: "T√¥i l√† The Traveler! S·∫µn s√†ng cho m·ªçi tr·∫£i nghi·ªám c√πng gia ƒë√¨nh. C√≤n b·∫°n? #BMW #MeetYourMatch #TheTraveler"
            },
            Visionary: {
                icon: '<i class="fa-solid fa-microchip"></i>', // ƒê√£ thay ƒë·ªïi
                name: "THE VISIONARY",
                car: "BMW i Series - i4, i7, iX",
                slogan: "C√¥ng ngh·ªá - T∆∞∆°ng lai - Drive the future",
                description: "B·∫°n l√† ng∆∞·ªùi ti√™n phong, lu√¥n ƒë√≥n nh·∫≠n c√¥ng ngh·ªá m·ªõi v√† h∆∞·ªõng ƒë·∫øn t∆∞∆°ng lai b·ªÅn v·ªØng. BMW i Series v·ªõi ƒë·ªông c∆° ƒëi·ªán ho√†n to√†n, c√¥ng ngh·ªá AI v√† thi·∫øt k·∫ø t∆∞∆°ng lai l√† s·ª± l·ª±a ch·ªçn ho√†n h·∫£o.",
                traits: [
                    { icon: '<i class="fa-solid fa-rocket"></i>', name: "Ti√™n phong", desc: "D·∫´n ƒë·∫ßu xu h∆∞·ªõng c√¥ng ngh·ªá" }, // ƒê√£ thay ƒë·ªïi
                    { icon: '<i class="fa-solid fa-leaf"></i>', name: "B·ªÅn v·ªØng", desc: "Quan t√¢m m√¥i tr∆∞·ªùng" }, // ƒê√£ thay ƒë·ªïi
                    { icon: '<i class="fa-solid fa-robot"></i>', name: "Th√¥ng minh", desc: "Y√™u c√¥ng ngh·ªá AI" } // ƒê√£ thay ƒë·ªïi
                ],
                features: [
                    { label: "D√≤ng xe", value: "BMW i4 / i7 / iX" },
                    { label: "ƒê·∫∑c ƒëi·ªÉm", value: "Xe ƒëi·ªán, c√¥ng ngh·ªá t∆∞∆°ng lai" },
                    { label: "Ph√π h·ª£p", value: "Doanh nh√¢n, tech lover" },
                    { label: "C√¥ng ngh·ªá", value: "100% ƒëi·ªán, AI Assistant" }
                ],
                id: "visionary",
                carsList: ["BMW i4", "BMW i7", "BMW iX"],
                ogImage: "https://placehold.co/1200x630/9B59B6/FFFFFF?text=THE%20VISIONARY&font=exo2",
                shareText: "T√¥i l√† The Visionary! Lu√¥n h∆∞·ªõng t·ªõi c√¥ng ngh·ªá v√† t∆∞∆°ng lai. C√≤n b·∫°n? #BMW #MeetYourMatch #TheVisionary"
            },
            Performer: {
                icon: '<i class="fa-solid fa-flag-checkered"></i>', // ƒê√£ thay ƒë·ªïi
                name: "THE PERFORMER",
                car: "BMW M Series - M3, M4, M5",
                slogan: "T·ªëc ƒë·ªô - Th√°ch th·ª©c - Drive the performance",
                description: "B·∫°n l√† ng∆∞·ªùi ƒëam m√™ t·ªëc ƒë·ªô, y√™u th√≠ch c·∫£m gi√°c m·∫°nh v√† lu√¥n mu·ªën chinh ph·ª•c th·ª≠ th√°ch. BMW M Series v·ªõi hi·ªáu nƒÉng v∆∞·ª£t tr·ªôi, ƒë·ªông c∆° m·∫°nh m·∫Ω v√† c√¥ng ngh·ªá ƒëua l√† l·ª±a ch·ªçn d√†nh cho b·∫°n.",
                traits: [
                    { icon: '<i class="fa-solid fa-bolt-lightning"></i>', name: "M·∫°nh m·∫Ω", desc: "ƒê·ªông c∆° hi·ªáu su·∫•t cao" }, // ƒê√£ thay ƒë·ªïi
                    { icon: '<i class="fa-solid fa-bullseye"></i>', name: "Quy·∫øt ƒëo√°n", desc: "Lu√¥n d·∫´n ƒë·∫ßu" }, // ƒê√£ thay ƒë·ªïi
                    { icon: '<i class="fa-solid fa-fire"></i>', name: "ƒêam m√™", desc: "Y√™u t·ªëc ƒë·ªô v√† c·∫£m gi√°c l√°i" } // ƒê√£ thay ƒë·ªïi
                ],
                features: [
                    { label: "D√≤ng xe", value: "BMW M3 / M4 / M5" },
                    { label: "ƒê·∫∑c ƒëi·ªÉm", value: "Hi·ªáu su·∫•t cao, th·ªÉ thao" },
                    { label: "Ph√π h·ª£p", value: "Ng∆∞·ªùi y√™u t·ªëc ƒë·ªô" },
                    { label: "C√¥ng ngh·ªá", value: "M Sport, Track Mode" }
                ],
                id: "performer",
                carsList: ["BMW M3", "BMW M4", "BMW M5"],
                ogImage: "https://placehold.co/1200x630/E74C3C/FFFFFF?text=THE%20PERFORMER&font=exo2",
                shareText: "T√¥i l√† The Performer! Sinh ra ƒë·ªÉ chinh ph·ª•c t·ªëc ƒë·ªô v√† ƒëam m√™. C√≤n b·∫°n? #BMW #MeetYourMatch #ThePerformer"
            },
            Icon: {
                icon: '<i class="fa-solid fa-gem"></i>', // ƒê√£ thay ƒë·ªïi
                name: "THE ICON",
                car: "BMW 3 Series / 5 Series / 7 Series",
                slogan: "L·ªãch l√£m - Kh·∫≥ng ƒë·ªãnh BMW - Meet the legacy",
                description: "B·∫°n l√† ng∆∞·ªùi tr·ªçng phong c√°ch, ƒë·∫≥ng c·∫•p v√† s·ª± ho√†n h·∫£o trong t·ª´ng chi ti·∫øt. BMW Series c·ªï ƒëi·ªÉn v·ªõi thi·∫øt k·∫ø thanh l·ªãch, c√¥ng ngh·ªá tinh t·∫ø l√† bi·ªÉu t∆∞·ª£ng c·ªßa s·ª± th√†nh c√¥ng.",
                traits: [
                    { icon: '<i class="fa-solid fa-user-tie"></i>', name: "Thanh l·ªãch", desc: "Phong c√°ch chuy√™n nghi·ªáp" }, // ƒê√£ thay ƒë·ªïi
                    { icon: '<i class="fa-solid fa-star"></i>', name: "ƒê·∫≥ng c·∫•p", desc: "Lu√¥n ho√†n h·∫£o trong m·ªçi chi ti·∫øt" }, // ƒê√£ thay ƒë·ªïi
                    { icon: '<i class="fa-solid fa-award"></i>', name: "Tinh t·∫ø", desc: "Bi·∫øt ƒë√°nh gi√° gi√° tr·ªã" } // ƒê√£ thay ƒë·ªïi
                ],
                features: [
                    { label: "D√≤ng xe", value: "BMW 3 / 5 / 7 Series" },
                    { label: "ƒê·∫∑c ƒëi·ªÉm", value: "Sedan cao c·∫•p, thanh l·ªãch" },
                    { label: "Ph√π h·ª£p", value: "Doanh nh√¢n, l√£nh ƒë·∫°o" },
                    { label: "C√¥ng ngh·ªá", value: "Luxury Line, Executive" }
                ],
                id: "icon",
                carsList: ["BMW 3 Series", "BMW 5 Series", "BMW 7 Series"],
                ogImage: "https://placehold.co/1200x630/0066CC/FFFFFF?text=THE%20ICON&font=exo2",
                shareText: "T√¥i l√† The Icon! M·ªôt di s·∫£n c·ªßa s·ª± linh ho·∫°t v√† ƒë·∫≥ng c·∫•p. C√≤n b·∫°n? #BMW #MeetYourMatch #TheIcon"
            }
        };

        // --- (M·ªöI) Danh s√°ch T·∫§T C·∫¢ c√°c d√≤ng xe ---
        const ALL_CAR_MODELS = [
            "BMW 3 Series", "BMW 5 Series", "BMW 7 Series",
            "BMW X3", "BMW X5", "BMW X7",
            "BMW i4", "BMW i7", "BMW iX",
            "BMW M3", "BMW M4", "BMW M5"
        ];

        // --- Bi·∫øn l∆∞u tr·ªØ ---
        let currentQuestion = 0;
        let answers = [];
        let customerName = "";
        
        let state = {
            finalResultType: null,
            isFormVisible: false
        };

        // --- Bi·∫øn DOM ---
        const $ = (selector) => document.getElementById(selector);
        
        // DOM Quiz
        const welcomeSection = $('welcomeSection');
        const quizSection = $('quizSection');
        const resultSection = $('resultSection');
        const startBtn = $('startBtn');
        const customerNameInput = $('customerName');
        const nextBtn = $('nextBtn');
        const progressBar = $('progressBar');
        const questionsContainer = $('questionsContainer');
        
        // DOM Modal
        const modalElements = {
            modal: $('share-modal'),
            modalContent: $('share-modal-content'),
            closeBtn: $('close-modal-btn'),
            confirmButtons: $('drive-confirm-buttons'),
            registerYesBtn: $('register-yes-btn'),
            registerNoBtn: $('register-no-btn'),
            registerForm: $('register-form'),
            formFullName: $('full-name'), 
            shareSection: $('social-share-section'),
            shareLink: $('share-link'),
            completeBtn: $('complete-btn'),
            loadingSpinner: $('loading-spinner'),
            formStatus: $('form-status'),
            carModelSelect: $('car-model'),
            
            // (M·ªöI) DOM cho Video Modal
            guideModal: $('guide-modal'),
            guideModalContent: $('guide-modal-content'),
            closeGuideBtn: $('close-guide-btn'),
            guideVideoIframe: $('guide-video-iframe')
        };
        const openModalBtn = $('open-share-modal-btn');
        const openGuideBtn = $('open-guide-btn'); // (M·ªöI)
        
        // --- (M·ªöI) Bi·∫øn l∆∞u src video
        const originalVideoSrc = modalElements.guideVideoIframe.src;

        // --- H√†m B·∫Øt ƒë·∫ßu quiz ---
        function startQuiz() {
            customerName = customerNameInput.value.trim();
            
            if (!customerName) {
                // (M·ªöI) Th√¥ng b√°o l·ªói d√πng Tailwind
                startBtn.textContent = 'Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n!';
                startBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                startBtn.classList.remove('bg-bmw-blue', 'hover:bg-bmw-light');
                setTimeout(() => {
                    <!-- (THAY TH·∫æ) C·∫≠p nh·∫≠t icon Font Awesome -->
                    startBtn.innerHTML = 'B·∫Øt ƒë·∫ßu ngay! <i class="fa-solid fa-arrow-right w-5 h-5 transition-transform group-hover:translate-x-1"></i>';
                    // (X√ìA) lucide.createIcons(); // T·∫°o l·∫°i icon
                    startBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                    startBtn.classList.add('bg-bmw-blue', 'hover:bg-bmw-light');
                }, 2000);
                return;
            }

            welcomeSection.classList.remove('active');
            quizSection.classList.add('active');
            
            renderQuestion();
            updateProgress();
            // (X√ìA) lucide.createIcons(); // T·∫°o icon cho c√°c n√∫t
        }

        // --- H√†m Render c√¢u h·ªèi ---
        function renderQuestion() {
            const question = questions[currentQuestion];
            
            questionsContainer.innerHTML = `
                <div class="question-number text-sm font-semibold text-bmw-blue mb-2">C√¢u ${currentQuestion + 1} / ${questions.length}</div>
                <div class="question-text text-2xl font-bold text-zinc-900 mb-8 font-heading">${question.text}</div>
                <div class="options flex flex-col gap-4" style="margin-bottom: 32px;" >
                    ${question.options.map((opt, idx) => `
                        <div class="option flex items-center p-5 bg-white rounded-lg border-2 border-gray-300 cursor-pointer transition-all duration-200 hover:border-bmw-blue hover:bg-gray-50" onclick="selectOption(${idx}, this)">
                            <div class="option-label w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-600 flex-shrink-0 transition-all duration-200">${String.fromCharCode(65 + idx)}</div>
                            <div class="option-text ml-4 flex-1 text-lg text-zinc-900">${opt.text}</div>
                            <span class="badge ml-auto bg-gray-200 text-gray-600 text-xs font-medium px-3 py-1 rounded-full whitespace-nowrap">${opt.type}</span>
                        </div>
                    `).join('')}
                </div>
            `;

            // Hi·ªÉn th·ªã l·ª±a ch·ªçn c≈© n·∫øu c√≥
            if (answers[currentQuestion] !== undefined) {
                const options = questionsContainer.querySelectorAll('.option');
                const selectedEl = options[answers[currentQuestion]];
                
                // (M·ªöI) √Åp d·ª•ng class Tailwind cho l·ª±a ch·ªçn c≈©
                selectedEl.classList.add('border-bmw-blue', 'bg-blue-100');
                selectedEl.querySelector('.option-label').classList.add('bg-bmw-blue', 'text-white');
                selectedEl.querySelector('.option-label').classList.remove('bg-gray-200', 'text-gray-600');
                selectedEl.querySelector('.badge').classList.add('bg-bmw-blue', 'text-white');
                selectedEl.querySelector('.badge').classList.remove('bg-gray-200', 'text-gray-600');
                
                nextBtn.disabled = false;
            }
        }

        // --- H√†m Ch·ªçn ƒë√°p √°n ---
        function selectOption(index, element) {
            answers[currentQuestion] = index;
            
            const options = element.closest('.options').querySelectorAll('.option');
            
            // (M·ªöI) Reset t·∫•t c·∫£ option v·ªÅ style m·∫∑c ƒë·ªãnh
            options.forEach(opt => {
                opt.classList.remove('border-bmw-blue', 'bg-blue-100');
                opt.querySelector('.option-label').classList.remove('bg-bmw-blue', 'text-white');
                opt.querySelector('.option-label').classList.add('bg-gray-200', 'text-gray-600');
                opt.querySelector('.badge').classList.remove('bg-bmw-blue', 'text-white');
                opt.querySelector('.badge').classList.add('bg-gray-200', 'text-gray-600');
            });
            
            // (M·ªöI) √Åp d·ª•ng style selected
            element.classList.add('border-bmw-blue', 'bg-blue-100');
            element.querySelector('.option-label').classList.add('bg-bmw-blue', 'text-white');
            element.querySelector('.option-label').classList.remove('bg-gray-200', 'text-gray-600');
            element.querySelector('.badge').classList.add('bg-bmw-blue', 'text-white');
            element.querySelector('.badge').classList.remove('bg-gray-200', 'text-gray-600');
            
            nextBtn.disabled = false;
        }

        // --- H√†m C√¢u ti·∫øp theo ---
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                renderQuestion();
                updateProgress();
                nextBtn.disabled = true;
                window.scrollTo(0, 0);
            } else {
                showResult();
            }
        }

        // --- H√†m Quay l·∫°i ---
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
                updateProgress();
            }
        }

        // --- H√†m C·∫≠p nh·∫≠t progress bar ---
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            progressBar.style.width = progress + '%';
            
            if (currentQuestion === questions.length - 1) {
                // (THAY ƒê·ªîI) Th√™m icon v√†o n√∫t xem k·∫øt qu·∫£
                nextBtn.innerHTML = 'Xem k·∫øt qu·∫£! <i class="fa-solid fa-flag-checkered ml-2"></i>';
            } else {
                nextBtn.innerHTML = 'Ti·∫øp theo'; // Reset v·ªÅ text
            }
        }

        // --- H√†m Hi·ªÉn th·ªã k·∫øt qu·∫£ ---
        function showResult() {
            const typeCounts = {};
            answers.forEach((answerIdx, questionIdx) => {
                const type = questions[questionIdx].options[answerIdx].type;
                typeCounts[type] = (typeCounts[type] || 0) + 1;
            });

            let maxType = null;
            let maxCount = -1;
            const priorityOrder = ['Icon', 'Traveler', 'Visionary', 'Performer'];

            for (const type of priorityOrder) {
                const count = typeCounts[type] || 0;
                if (count >= maxCount) {
                    maxCount = count;
                    maxType = type;
                }
            }
            if (!maxType) maxType = 'Icon'; 

            const result = carTypes[maxType];
            state.finalResultType = result; 

            quizSection.classList.remove('active');
            resultSection.classList.add('active');

            // (THAY ƒê·ªîI) D√πng innerHTML ƒë·ªÉ render icon Font Awesome
            $('resultIcon').innerHTML = result.icon;
            $('resultTitle').textContent = `${customerName} l√† ${result.name}!`;
            $('resultSubtitle').textContent = result.car;
            $('resultDesc').textContent = result.description;

            // (M·ªöI) Render Personality traits v·ªõi Tailwind
            // (THAY ƒê·ªîI) D√πng innerHTML cho trait.icon
            $('personalityTraits').innerHTML = result.traits.map(trait => `
                <div class="trait-card bg-white shadow-sm border border-gray-200 p-6 rounded-lg text-center transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                    <div class="trait-icon text-4xl mb-3 text-bmw-blue">${trait.icon}</div>
                    <div class="trait-name text-lg font-semibold text-zinc-900 mb-1">${trait.name}</div>
                    <div class="trait-desc text-sm text-gray-600">${trait.desc}</div>
                </div>
            `).join('');

            // (M·ªöI) Render Car details v·ªõi Tailwind
            $('carDetails').innerHTML = result.features.map(feature => `
                <div class="detail-row flex justify-between items-center py-4 border-b border-gray-200 last:border-b-0">
                    <span class="detail-label text-gray-500">${feature.label}:</span>
                    <span class="detail-value font-semibold text-zinc-900 text-lg">${feature.value}</span>
                </div>
            `).join('');

            updateMetaTags(result);
            updateCarModelDropdown(); // (THAY ƒê·ªîI) G·ªçi h√†m kh√¥ng c·∫ßn tham s·ªë
            // (X√ìA) lucide.createIcons();
            window.scrollTo(0, 0);
        }
        
        // --- H√†m Ch∆°i l·∫°i ---
        function restartQuiz() {
            currentQuestion = 0;
            answers = [];
            customerName = "";
            state.finalResultType = null;
            state.isFormVisible = false;
            
            resultSection.classList.remove('active');
            welcomeSection.classList.add('active');
            customerNameInput.value = '';
            nextBtn.disabled = true;
            nextBtn.innerHTML = 'Ti·∫øp theo'; // Reset v·ªÅ text
            
            window.scrollTo(0, 0);
        }

        // --- LOGIC MODAL & CHIA S·∫∫ ---

        function updateMetaTags(data) {
            if (!data) return;
            const shareTitle = `${customerName || 'B·∫°n'} l√† ${data.name}!`;
            document.querySelector('meta[property="og:title"]').setAttribute('content', `BMW Match: ${shareTitle}`);
            const shareDesc = `${customerName || 'M·ªôt ng∆∞·ªùi b·∫°n'} ƒë√£ kh√°m ph√° ra c√° t√≠nh BMW c·ªßa m√¨nh l√† ${data.name}. C√≤n b·∫°n? #BMW #MeetYourMatch`;
            document.querySelector('meta[property="og:description"]').setAttribute('content', shareDesc);
            document.querySelector('meta[property="og:image"]').setAttribute('content', data.ogImage);
        }

        // (THAY ƒê·ªîI) H√†m n√†y gi·ªù s·∫Ω load T·∫§T C·∫¢ c√°c d√≤ng xe
        function updateCarModelDropdown() {
            // (X√ìA) if (!data) return;
            const select = modalElements.carModelSelect;
            select.innerHTML = '';

            // (THAY ƒê·ªîI) D√πng danh s√°ch ALL_CAR_MODELS
            ALL_CAR_MODELS.forEach(car => {
                const option = document.createElement('option');
                option.value = car;
                option.textContent = car;
                select.appendChild(option);
            });
            
            if (ALL_CAR_MODELS.length > 0) {
                select.value = ALL_CAR_MODELS[0]; // Ch·ªçn gi√° tr·ªã m·∫∑c ƒë·ªãnh
            }
        }

        function openShareModal() {
            state.isFormVisible = false;
            modalElements.registerForm.classList.add('hidden');
            modalElements.shareSection.classList.add('hidden');
            modalElements.confirmButtons.classList.remove('hidden');
            modalElements.formStatus.textContent = '';
            modalElements.shareLink.value = ''; 
            modalElements.formFullName.value = customerName;

            modalElements.modal.classList.remove('hidden');
            setTimeout(() => modalElements.modal.classList.add('opacity-100'), 10);
            setTimeout(() => modalElements.modalContent.classList.add('scale-100'), 10); // Th√™m
            // (X√ìA) lucide.createIcons();
        }

        function closeModal() {
        modalElements.modal.classList.remove('opacity-100');
        modalElements.modalContent.classList.remove('scale-100'); // Th√™m
        setTimeout(() => modalElements.modal.classList.add('hidden'), 300);
    }

    // --- (M·ªöI) H√†m cho Video Modal ---
    function openGuideModal() {
        modalElements.guideModal.classList.remove('hidden');
        setTimeout(() => {
            modalElements.guideModal.classList.add('opacity-100');
            modalElements.guideModalContent.classList.add('scale-100');
            // T·∫£i l·∫°i src ƒë·ªÉ autoplay (n·∫øu tr√¨nh duy·ªát cho ph√©p)
            modalElements.guideVideoIframe.src = originalVideoSrc + "?autoplay=1"; 
        }, 10);
    }

    function closeGuideModal() {
        modalElements.guideModal.classList.remove('opacity-100');
        modalElements.guideModalContent.classList.remove('scale-100');
        setTimeout(() => {
            modalElements.guideModal.classList.add('hidden');
            // D·ª´ng video b·∫±ng c√°ch x√≥a src
            modalElements.guideVideoIframe.src = ""; 
            // Ph·ª•c h·ªìi src g·ªëc ƒë·ªÉ l·∫ßn sau m·ªü l·∫°i
            setTimeout(() => { 
                modalElements.guideVideoIframe.src = originalVideoSrc;
            }, 100);
        }, 300);
    }
    // --- H·∫øt H√†m cho Video Modal ---


    function toggleRegisterForm(show) {
        state.isFormVisible = show;
            modalElements.confirmButtons.classList.add('hidden');
            modalElements.shareSection.classList.remove('hidden');
            // (X√ìA) lucide.createIcons();

            if (show) {
                modalElements.registerForm.classList.remove('hidden');
            } else {
                modalElements.registerForm.classList.add('hidden');
            }
            modalElements.shareLink.required = true;
        }

        // (ƒê√É X√ìA) function handleShare(platform)
        // C√°c n√∫t FB, Zalo ƒë√£ b·ªã v√¥ hi·ªáu h√≥a

        // (M·ªöI) H√†m copy link (Ho·∫°t ƒë·ªông)
        function handleCopyLink() {
            const data = state.finalResultType;
            if (!data) return;

            const sharePage = `${data.id}.html`;
            const baseUrl = window.location.origin + window.location.pathname.replace(/[^/]*\.html$/, '');
            const currentUrl = baseUrl + sharePage;

            // (C·∫¨P NH·∫¨T) Tr√≠ch xu·∫•t hashtags t·ª´ data.shareText
            const shareTextHashtags = (data.shareText.match(/#\w+/g) || []).join(' '); // V√≠ d·ª•: #BMW #MeetYourMatch #TheTraveler
            
            // (C·∫¨P NH·∫¨T) Ch·ªâ copy URL + Hashtags
            const globalHashtags = "#ThacoAuto #BMWVietnam #DriveYourPassion";
            // (THAY ƒê·ªîI) Th√™m \n ƒë·ªÉ xu·ªëng d√≤ng gi·ªØa hashtag v√† URL
            const textToCopy = `${shareTextHashtags} ${globalHashtags}\n${currentUrl}`;

            modalElements.formStatus.textContent = '';
            modalElements.formStatus.className = 'text-center text-sm mt-4';

            if (navigator.clipboard) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    modalElements.formStatus.textContent = '‚úÖ ƒê√£ copy link & hashtag!';
                    modalElements.formStatus.className = 'text-center text-sm mt-4 text-green-500';
                }).catch(err => {
                    fallbackCopyText(textToCopy);
                });
            } else {
                fallbackCopyText(textToCopy);
            }
        }
        
        function fallbackCopyText(text) {
             const input = document.createElement('textarea');
             input.value = text;
             input.style.position = 'fixed';
             input.style.opacity = '0';
             document.body.appendChild(input);
             input.select();
             try {
                 document.execCommand('copy');
                 modalElements.formStatus.textContent = '‚úÖ ƒê√£ copy link & hashtag!';
                 modalElements.formStatus.className = 'text-center text-sm mt-4 text-green-500';
             } catch (err) {
                 modalElements.formStatus.textContent = 'L·ªói! Kh√¥ng th·ªÉ copy link.';
                 modalElements.formStatus.className = 'text-center text-sm mt-4 text-red-500';
             }
             document.body.removeChild(input);
        }

        async function handleSubmit(event) {
            event.preventDefault();
            
            let formDataObj = {};
            
            if (!modalElements.shareLink.value.trim() || !modalElements.shareLink.checkValidity()) {
                modalElements.formStatus.textContent = 'Vui l√≤ng d√°n link b√†i vi·∫øt ƒë√£ chia s·∫ª (URL h·ª£p l·ªá).';
                modalElements.formStatus.className = 'text-center text-sm mt-4 text-red-500';
                modalElements.shareLink.focus();
                return;
            }

            if (state.isFormVisible) {
                const form = modalElements.registerForm;
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                const formData = new FormData(form);
                formData.forEach((value, key) => { formDataObj[key] = value; });
            }
            
            formDataObj['share-link'] = modalElements.shareLink.value;
            formDataObj['result'] = state.finalResultType.id;
            formDataObj['customerName'] = customerName;
            formDataObj['timestamp'] = new Date().toISOString();

            // --- G·ª¨I DATA V·ªÄ GOOGLE SHEETS ---
            // B·∫°n C·∫¶N thay th·∫ø URL n√†y b·∫±ng URL Google Apps Script c·ªßa b·∫°n
            const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'; 
            
            modalElements.loadingSpinner.classList.remove('hidden');
            modalElements.completeBtn.disabled = true;
            modalElements.formStatus.textContent = 'ƒêang g·ª≠i th√¥ng tin...';
            modalElements.formStatus.className = 'text-center text-sm mt-4 text-gray-400';

            try {
                // T·∫°m th·ªùi comment out ƒë·ªÉ test, b·∫≠t l·∫°i khi c√≥ link
                /*
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formDataObj)
                });
                */

                await new Promise(resolve => setTimeout(resolve, 1500));
                console.log("D·ªØ li·ªáu form (test):", formDataObj);
                
                modalElements.formStatus.textContent = 'Ho√†n th√†nh! C·∫£m ∆°n b·∫°n ƒë√£ tham gia.';
                modalElements.formStatus.className = 'text-center text-sm mt-4 text-green-500';
                
                setTimeout(closeModal, 3000);

            } catch (error) {
                console.error('Error submitting form:', error);
                modalElements.formStatus.textContent = 'ƒê√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.';
                modalElements.formStatus.className = 'text-center text-sm mt-4 text-red-500';
            } finally {
                modalElements.loadingSpinner.classList.add('hidden');
                modalElements.completeBtn.disabled = false;
            }
        }
        
        // G√°n Event Listeners
        openModalBtn.onclick = openShareModal;
        modalElements.closeBtn.onclick = closeModal;
        modalElements.registerYesBtn.onclick = () => toggleRegisterForm(true);
    modalElements.registerNoBtn.onclick = () => toggleRegisterForm(false);
    modalElements.completeBtn.onclick = handleSubmit;
    modalElements.registerForm.onsubmit = handleSubmit; 
    
    // (M·ªöI) G√°n Event Listeners cho Video Modal
    openGuideBtn.onclick = openGuideModal;
    modalElements.closeGuideBtn.onclick = closeGuideModal;


    function init() {
        const urlParams = new URLSearchParams(window.location.search);
            const resultParam = urlParams.get('result'); 
            
            let resultKey = "Icon";
            if (resultParam) {
                resultKey = resultParam.charAt(0).toUpperCase() + resultParam.slice(1);
            }

            if (resultParam && carTypes[resultKey]) {
                customerName = "M·ªôt ng∆∞·ªùi b·∫°n"; 
                updateMetaTags(carTypes[resultKey]);
            }
            
            // (X√ìA) Kh·ªüi t·∫°o icon cho n√∫t start
            // lucide.createIcons();
        }

        init();

    </script>
</body>
</html>
